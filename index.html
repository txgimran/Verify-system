<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Device Verification</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  background:#0b0f1a;
  color:#fff;
  font-family:Arial,Helvetica,sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.box{
  width:100%;
  max-width:380px;
  background:#131a2b;
  border-radius:16px;
  padding:30px;
  text-align:center;
  box-shadow:0 0 40px rgba(0,136,255,.3);
}
h2{margin-bottom:10px}
#status{margin:20px 0;font-size:18px}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:10px;
  font-size:16px;
  color:#fff;
  cursor:pointer;
}
.ok{background:#00ff88;color:#000}
.err{background:#ff3366}
</style>
</head>
<body>

<div class="box">
  <h2>üîê Device Verification</h2>
  <div id="status">Checking device‚Ä¶</div>
  <button id="closeBtn" style="display:none">Close</button>
</div>

<script>
// ---------- HASH ----------
async function sha256(str){
  const buf = new TextEncoder().encode(str);
  const hash = await crypto.subtle.digest("SHA-256", buf);
  return [...new Uint8Array(hash)].map(b=>b.toString(16).padStart(2,"0")).join("");
}

// ---------- DEVICE FINGERPRINT ----------
async function getDeviceHash(){
  const canvas=document.createElement("canvas");
  const ctx=canvas.getContext("2d");
  ctx.font="14px Arial";
  ctx.fillText(navigator.userAgent,10,20);

  const data=[
    navigator.userAgent,
    navigator.language,
    screen.width+"x"+screen.height,
    Intl.DateTimeFormat().resolvedOptions().timeZone,
    canvas.toDataURL()
  ].join("|");

  return (await sha256(data)).slice(0,32);
}

// ---------- VPN CHECK ----------
async function checkVPN(){
  try{
    const r=await fetch("https://ipapi.co/json/");
    const j=await r.json();
    const org=(j.org||"").toLowerCase();
    return org.includes("vpn")||org.includes("proxy")||j.security?.vpn===true;
  }catch(e){
    return false;
  }
}

// ---------- SEND TO WEBHOOK ----------
async function send(webhook,data){
  await fetch(webhook,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(data)
  });
}

// ---------- MAIN ----------
(async()=>{
  const statusEl=document.getElementById("status");
  const btn=document.getElementById("closeBtn");
  const p=new URLSearchParams(location.search);
  const webhook=p.get("webhookUrl");

  if(!webhook){
    statusEl.textContent="‚ùå Invalid link";
    return;
  }

  const hash=await getDeviceHash();
  const vpn=await checkVPN();

  let payload={
    status: vpn ? "vpn" : "verified",
    user_hash: hash
  };

  await send(webhook,payload);

  if(vpn){
    statusEl.textContent="üö® VPN detected. Access blocked.";
    btn.className="err";
  }else{
    statusEl.textContent="‚úÖ Device verified successfully!";
    btn.className="ok";
  }

  btn.style.display="block";
  btn.onclick=()=>{
    if(window.Telegram?.WebApp) Telegram.WebApp.close();
    else window.close();
  };
})();
</script>

</body>
  </html>
